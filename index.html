<!doctype html>
<html lang="it" dir="ltr" data-theme="dark" data-language="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">

  <title>Opera viva | Navi, equipaggi, tecniche antiche</title>
  <link rel="icon" href="favicon.jpg">
  <meta name="description" content="Opera viva è un progetto fotografico che segue navi, marinai e porti. Collodio umido, pellicola e infrarosso per trasformare ogni imbarcazione in un’opera senza tempo.">
  <meta name="robots" content="index,follow,max-image-preview:large">
  <meta name="color-scheme" content="dark light">
  <meta name="theme-color" content="#0b0c0f">
  <meta name="format-detection" content="telephone=no">

  <!-- TODO: aggiorna con dominio reale -->
  <link rel="canonical" href="https://operaviva.it/">

  <link rel="icon" href="favicon.ico">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">

  <meta property="og:locale" content="it_IT">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Opera viva">
  <meta property="og:title" content="Opera viva">
  <meta property="og:description" content="Navi, equipaggi, porti. Collodio umido, pellicola e infrarosso per fissare monumenti di luce.">
  <meta property="og:url" content="https://operaviva.it/">
  <!-- TODO: aggiorna cover reale -->
  <meta property="og:image" content="https://operaviva.it/img/og-cover.jpg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:alt" content="Opera viva">
  <meta name="twitter:card" content="summary_large_image">

  <link rel="alternate" hreflang="it" href="https://operaviva.it/">
  <link rel="alternate" hreflang="en" href="https://operaviva.it/?lang=en">
  <link rel="alternate" hreflang="x-default" href="https://operaviva.it/">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,300..900&family=Inter:wght@200..900&display=swap" rel="stylesheet">

  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" referrerpolicy="no-referrer">

  <!-- Lightbox (CDN) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css">

  <style>
    :root{ color-scheme: dark light; }
    html, body{ overflow-x:hidden; }
    body{ margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    a{ color:inherit; }
    .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
    .skip-link{ position:absolute; left:-9999px; top:0; padding:.75rem 1rem; background:#111; border:1px solid #333; border-radius:.75rem; z-index:9999; }
    .skip-link:focus{ left:.75rem; top:.75rem; }

    /* TECH STACK (normal scroll page) */
    .techStack{ padding-top: calc(var(--s-6) + 30px); }
    .techStack__head{ padding: var(--s-5) 0 var(--s-4); }
    .techStack__sections{ display:flex; flex-direction:column; gap: var(--s-6); padding-bottom: var(--s-6); }

    [data-view="techniques"]{ height:auto; overflow: visible; }

    .techSection{ border-top: 1px solid color-mix(in oklab, var(--border) 75%, transparent); padding-top: var(--s-5); }
    .techSection__grid{ display:grid; grid-template-columns: 1fr 1fr; gap: var(--s-4); align-items: start; }
    .techSection__grid--flip .techSection__media{ order: 2; }
    .techSection__grid--flip .techSection__copy{ order: 1; }

    @media (max-width: 900px){
      .techSection__grid{ grid-template-columns: 1fr; gap: var(--s-3); }
      .techSection__grid--flip .techSection__media,
      .techSection__grid--flip .techSection__copy{ order: initial; }
    }

    .techMedia{
      position: relative;
      border: 1px solid color-mix(in oklab, var(--border) 75%, transparent);
      overflow: hidden;
      background: color-mix(in oklab, var(--surface) 82%, transparent);
    }
    .techMedia .media__ph{
      position: absolute;
      inset: 0;
      z-index: 0;
    }
    .techMedia img{
      position: relative;
      z-index: 1;
      width: 100%;
      height: auto;
      display: block;
      opacity: 0;
      transform: translateY(8px) scale(1.01);
      filter: blur(2px);
      transition: opacity 620ms var(--ease-out), transform 980ms var(--ease-out), filter 980ms var(--ease-out);
      will-change: opacity, transform, filter;
    }
    .techMedia.is-loaded img{
      opacity: 1;
      transform: translateY(0) scale(1);
      filter: blur(0);
    }
    .techMedia.is-loaded .media__ph{
      opacity: 0;
      transition: opacity 520ms var(--ease-out);
      animation: none;
    }
    .techMedia.has-error img{ display: none; }

    .techSection__title{ font-family: var(--serif); letter-spacing: .02em; margin: 0 0 .8rem; font-size: clamp(1.4rem, 2.2vw, 2.1rem); }
    .techSection__p{ margin: 0 0 .9rem; color: var(--muted); line-height: 1.6; max-width: 68ch; }

    .techAnim{ opacity: 0; transform: translateY(56px); filter: blur(10px); transition: opacity .9s ease, transform .95s cubic-bezier(.2,.9,.2,1), filter .9s ease; will-change: transform, opacity, filter; }
    .techSection__media.techAnim{ transform: translateY(56px) scale(.98); }
    .techAnim.is-in{ opacity: 1; transform: translateY(0) scale(1); filter: blur(0); }
  </style>

  <style>
    :root{
      --font-body: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      --font-display: Fraunces, ui-serif, Georgia, serif;

      --fs-0: clamp(0.94rem, 0.88rem + 0.22vw, 1.02rem);
      --fs-1: clamp(1.08rem, 0.96rem + 0.55vw, 1.28rem);
      --fs-2: clamp(1.42rem, 1.10rem + 1.25vw, 2.00rem);
      --fs-3: clamp(1.95rem, 1.35rem + 2.25vw, 2.95rem);
      --fs-4: clamp(2.60rem, 1.70rem + 3.10vw, 3.90rem);

      --s-1: clamp(0.55rem, 0.44rem + 0.32vw, 0.72rem);
      --s-2: clamp(0.88rem, 0.70rem + 0.55vw, 1.18rem);
      --s-3: clamp(1.20rem, 0.95rem + 0.85vw, 1.70rem);
      --s-4: clamp(1.58rem, 1.15rem + 1.30vw, 2.25rem);
      --s-5: clamp(2.20rem, 1.45rem + 2.15vw, 3.30rem);
      --s-6: clamp(3.10rem, 2.00rem + 3.20vw, 5.10rem);

      --r-1: 12px;
      --r-2: 18px;
      --r-3: 28px;

      --r-ui: 6px;
      --ease-out: cubic-bezier(.16,1,.3,1);
      --ease-soft: cubic-bezier(.2,.8,.2,1);
      --dur-1: 180ms;
      --dur-2: 320ms;
      --dur-3: 720ms;

      --wrap: min(1120px, calc(100% - 2*clamp(1rem, 4vw, 2.2rem)));

      --accent: rgba(232,223,214,.92);
      --accent-soft: rgba(232,223,214,.14);
      --ph-breath: 2.6s;
    }

    :root[data-theme="dark"]{
      --bg: #212121;
      --bg-2: #1c1c1c;
      --bg-3: #242424;

      --surface: rgba(255,255,255,.035);
      --surface-2: rgba(255,255,255,.055);
      --surface-3: rgba(255,255,255,.075);

      --border: rgba(255,255,255,.10);
      --border-2: rgba(255,255,255,.16);

      --text: rgba(245,245,245,.93);
      --muted: rgba(216,216,216,.70);
      --muted-2: rgba(216,216,216,.54);

      --shadow: rgba(0,0,0,.60);
      --ph-1: rgba(255,255,255,.045);
      --ph-2: rgba(255,255,255,.095);
      --ok: #42d17a;
    }

    :root[data-theme="light"]{
      --bg: #ffffff;
      --bg-2: #f6f6f6;
      --bg-3: #efefef;

      --surface: rgba(0,0,0,.03);
      --surface-2: rgba(0,0,0,.055);
      --surface-3: rgba(0,0,0,.085);

      --border: rgba(0,0,0,.10);
      --border-2: rgba(0,0,0,.16);

      --text: rgba(0,0,0,.90);
      --muted: rgba(0,0,0,.67);
      --muted-2: rgba(0,0,0,.52);

      --shadow: rgba(0,0,0,.18);
      --ph-1: rgba(0,0,0,.035);
      --ph-2: rgba(0,0,0,.085);
      --ok: #1aa957;

      --accent: rgba(30,30,30,.92);
      --accent-soft: rgba(30,30,30,.10);
    }

    *{ box-sizing:border-box; }
    html{ scroll-behavior:smooth; }
    body{
      margin:0;
      font-family: var(--font-body);
      font-size: var(--fs-0);
      line-height: 1.58;
      letter-spacing: .015em;
      color: var(--text);
      background: linear-gradient(180deg, var(--bg), var(--bg));
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
      overflow-x: hidden;
    }

    img, video, iframe{ max-width:100%; display:block; }
    a{ color: inherit; text-decoration: none; }
    button{ font-family: inherit; color: inherit; }
    .wrap{ width: var(--wrap); margin-inline:auto; }
    .bleed{ width: 100vw; margin-left: calc(50% - 50vw); margin-right: calc(50% - 50vw); }

    body::before{
      content:"";
      position: fixed;
      inset: 0;
      pointer-events:none;
      opacity: .06;
      mix-blend-mode: overlay;
      background-image: radial-gradient(circle at 1px 1px, rgba(255,255,255,.14) 1px, transparent 0);
      background-size: 3px 3px;
    }

    @media (prefers-reduced-motion: reduce){
      html{ scroll-behavior:auto; }
      *, *::before, *::after{ animation-duration: 1ms !important; animation-iteration-count: 1 !important; transition-duration: 1ms !important; }
    }

    :root[data-language="it"] [lang="en"]{ display:none !important; }
    :root[data-language="en"] [lang="it"]{ display:none !important; }

    html, body{ touch-action: manipulation; }

    .kicker{
      margin: 0 0 var(--s-2);
      color: var(--muted-2);
      letter-spacing: .14em;
      text-transform: uppercase;
      font-size: .82em;
    }
    .h2{
      font-family: var(--font-display);
      font-size: var(--fs-3);
      line-height: 1.08;
      letter-spacing: .03em;
      margin: 0 0 var(--s-2);
    }
    .lead{ font-size: var(--fs-1); color: var(--muted); margin: 0 0 var(--s-3); max-width: 70ch; }
    .p{ margin: 0 0 var(--s-2); color: var(--muted); max-width: 78ch; }
    .micro{ font-size: .90em; color: var(--muted-2); margin: 0; letter-spacing: .08em; text-transform: uppercase; }

    .emph{ color: var(--accent); font-weight: 900; }
    :focus-visible{ outline: 2px solid color-mix(in oklab, var(--text) 55%, transparent); outline-offset: 3px; }

    .site-header{
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 70;
      background: transparent;
      pointer-events: auto;
    }

    .header__wrap{
      display:flex;
      align-items:center;
      justify-content: flex-end;
      padding: .90rem 0;
      position: relative;
    }

    .headerPill{
      display:inline-flex;
      align-items:center;
      gap: .65rem;
      position: relative;
      border-radius: 22px;
      padding: 0;
      background: transparent;
      border: 1px solid transparent;
      backdrop-filter: none;
      transition: background var(--dur-2) var(--ease-out), border-color var(--dur-2) var(--ease-out), backdrop-filter var(--dur-2) var(--ease-out), box-shadow var(--dur-2) var(--ease-out), padding var(--dur-2) var(--ease-out);
    }

    .headerHomeBtn{ margin-left:auto; }

    .site-header.is-scrolled .headerPill{
      padding: .35rem;
      backdrop-filter: blur(14px);
      background: color-mix(in oklab, var(--bg) 70%, transparent);
      border-color: color-mix(in oklab, var(--border) 85%, transparent);
      box-shadow: 0 22px 110px var(--shadow);
    }

    .site-header.is-over-hero .icon-btn,
    .site-header.is-over-hero .chip-btn{
      color: rgba(255,255,255,.93);
      border-color: rgba(255,255,255,.20);
      background: rgba(0,0,0,.18);
    }

    .site-header.is-over-hero.is-scrolled .headerPill{
      background: rgba(0,0,0,.32);
      border-color: rgba(255,255,255,.18);
    }

    .icon-btn{
      appearance:none;
      border: 1px solid color-mix(in oklab, var(--border) 85%, transparent);
      background: color-mix(in oklab, var(--surface) 92%, transparent);
      color: var(--text);
      width: 42px;
      height: 42px;
      border-radius: 16px;
      display:grid;
      place-items:center;
      cursor:pointer;
      transition: transform var(--dur-1) var(--ease-out), border-color var(--dur-2) var(--ease-out), background var(--dur-2) var(--ease-out), opacity var(--dur-2) var(--ease-out);
      box-shadow: 0 18px 80px var(--shadow);
    }
    .icon-btn:hover{ transform: translateY(-1px); border-color: var(--border-2); }
    .icon-btn:active{ transform: translateY(0); }
    .icon-btn.is-active{ border-color: color-mix(in oklab, var(--accent) 70%, transparent); }

    .chip-btn{
      appearance:none;
      border: 1px solid color-mix(in oklab, var(--border) 85%, transparent);
      background: color-mix(in oklab, var(--surface) 92%, transparent);
      color: var(--text);
      height: 42px;
      padding: 0 .75rem;
      border-radius: 16px;
      display:inline-flex;
      align-items:center;
      gap: .55rem;
      cursor:pointer;
      transition: transform var(--dur-1) var(--ease-out), border-color var(--dur-2) var(--ease-out), background var(--dur-2) var(--ease-out), opacity var(--dur-2) var(--ease-out);
      box-shadow: 0 18px 80px var(--shadow);
      letter-spacing: .14em;
      text-transform: uppercase;
      font-weight: 950;
      font-size: .78em;
      line-height: 1;
      white-space: nowrap;
    }
    .chip-btn:hover{ transform: translateY(-1px); border-color: var(--border-2); }
    .chip-btn:active{ transform: translateY(0); }
    .chip-label{ opacity: .95; }

    @media (max-width: 520px){
      .icon-btn{ width:40px; height:40px; }
      .chip-btn{ height:40px; }
    }

    .popMenu{
      position: absolute;
      top: calc(100% + 10px);
      right: 0;
      display:flex;
      align-items:center;
      gap: .55rem;
      padding: .55rem;
      border-radius: 18px;
      border: 1px solid color-mix(in oklab, var(--border) 85%, transparent);
      background: color-mix(in oklab, var(--bg) 70%, transparent);
      backdrop-filter: blur(14px);
      box-shadow: 0 26px 120px var(--shadow);
      transform-origin: top right;
      transform: translateY(-6px) scale(.98);
      opacity: 0;
      pointer-events: none;
      transition: opacity var(--dur-2) var(--ease-out), transform var(--dur-2) var(--ease-out);
    }
    .popMenu.is-open{
      opacity: 1;
      transform: translateY(0) scale(1);
      pointer-events: auto;
    }

    .section{ padding: var(--s-6) 0; }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:.55rem;
      padding: .95rem 1.25rem;
      border-radius: 999px;
      border: 1px solid var(--border);
      font-weight: 900;
      letter-spacing: .14em;
      text-transform: uppercase;
      cursor:pointer;
      transition: transform var(--dur-1) var(--ease-out), border-color var(--dur-2) var(--ease-out), background var(--dur-2) var(--ease-out), opacity var(--dur-2) var(--ease-out);
      font-size: .86em;
      line-height: 1;
      white-space: nowrap;
      color: var(--text);
      background: transparent;
    }
    .btn--primary{ background: color-mix(in oklab, var(--surface-2) 85%, transparent); }
    .btn--ghost{ background: transparent; }
    .btn:hover{ transform: translateY(-1px); border-color: var(--border-2); }
    .btn:active{ transform: translateY(0); }
    .btn i{ opacity: .9; font-size: 1em; }

    .viewShell{
      position: relative;
      min-height: 60vh;
      will-change: opacity, transform, filter;
    }
    .viewShell.is-swapping{ pointer-events: none; }
    .viewShell.is-leaving{
      opacity: 0;
      transform: translateY(10px);
      filter: blur(2px);
      transition: opacity var(--dur-3) var(--ease-out), transform var(--dur-3) var(--ease-out), filter var(--dur-3) var(--ease-out);
    }
    .viewShell.is-entering{
      opacity: 0;
      transform: translateY(10px);
      filter: blur(2px);
    }
    .viewShell.is-entered{
      opacity: 1;
      transform: translateY(0);
      filter: blur(0);
      transition: opacity var(--dur-3) var(--ease-out), transform var(--dur-3) var(--ease-out), filter var(--dur-3) var(--ease-out);
    }

    .hero{
      position: relative;
      padding: clamp(7.5rem, 12vh, 10.5rem) 0 var(--s-6);
      overflow: hidden;
      color: rgba(255,255,255,.93);
    }
    .hero .kicker{ color: rgba(255,255,255,.70); }
    .hero .hero__sub{ color: rgba(255,255,255,.76); }
    .hero .btn{
      color: rgba(255,255,255,.92);
      border-color: rgba(255,255,255,.20);
      background: rgba(0,0,0,.16);
    }
    .hero .btn--primary{ background: rgba(255,255,255,.10); }
    .hero .btn:hover{ border-color: rgba(255,255,255,.32); }

    .hero::after{
      content:"";
      position:absolute;
      inset:0;
      background:
        radial-gradient(120% 120% at 20% 0%, rgba(0,0,0,.10), rgba(0,0,0,.72)),
        linear-gradient(180deg, rgba(0,0,0,.40), rgba(0,0,0,.70));
      pointer-events:none;
      z-index: 2;
    }
    .heroVideo{
      position:absolute;
      inset:0;
      z-index: 1;
      overflow:hidden;
      background: linear-gradient(180deg, var(--bg-2), var(--bg));
    }
    .heroVideo__ph{
      position:absolute;
      inset:0;
      background:
        radial-gradient(140% 120% at 18% 10%, var(--ph-2), transparent 60%),
        radial-gradient(120% 120% at 82% 85%, var(--ph-1), transparent 65%),
        linear-gradient(180deg, var(--bg-2), var(--bg));
      animation: phBreath var(--ph-breath) var(--ease-soft) infinite;
      z-index: 1;
    }
    @keyframes phBreath{
      0%{ filter: contrast(1) brightness(1); opacity: .70; }
      50%{ filter: contrast(1.05) brightness(1.04); opacity: .95; }
      100%{ filter: contrast(1) brightness(1); opacity: .70; }
    }
    .heroVideo__thumb{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit: cover;
      object-position: center;
      opacity: 0;
      transform: scale(1.02);
      transition: opacity var(--dur-3) var(--ease-out), transform var(--dur-3) var(--ease-out);
      filter: contrast(1.02) saturate(.95);
      z-index: 2;
      pointer-events:none;
    }
    .heroVideo.is-thumb-loaded .heroVideo__thumb{ opacity: 1; transform: scale(1.00); }

    .heroVideo__mount{
      position:absolute;
      inset:0;
      z-index: 3;
      pointer-events:none;
      opacity: 0;
      transition: opacity var(--dur-3) var(--ease-out);
    }
    .heroVideo.is-mounted .heroVideo__mount{ opacity: 1; }

    .heroVideo__cover{
      position:absolute;
      inset:-10%;
      transform: scale(1.22);
      transform-origin:center;
    }
    .heroVideo__cover iframe{
      width:100%;
      height:100%;
      position:absolute;
      inset:0;
      border:0;
    }
    @media (max-width: 520px){
      .heroVideo__cover{ transform: scale(1.28); }
    }

    .hero__wrap{
      position: relative;
      z-index: 3;
      display:grid;
      grid-template-columns: 1fr;
      gap: var(--s-4);
      align-items: start;
    }
    .hero__title{
      font-family: var(--font-display);
      font-size: var(--fs-4);
      line-height: 1.02;
      letter-spacing: .02em;
      margin: 0 0 var(--s-2);
      max-width: 18ch;
    }
    .hero__sub{
      margin: 0 0 var(--s-3);
      max-width: 72ch;
      font-size: var(--fs-1);
    }
    .hero__cta{ display:flex; flex-wrap: wrap; gap: .75rem; align-items:center; }

    .scrollCue{
      margin-top: var(--s-4);
      display:flex;
      flex-direction: column;
      align-items: flex-start;
      gap: .60rem;
      width: fit-content;
      color: rgba(255,255,255,.60);
      letter-spacing: .14em;
      text-transform: uppercase;
      font-size: .78em;
      pointer-events:none;
    }
    .scrollCue__arrow{
      width: 46px;
      height: 46px;
      border: 1px solid rgba(255,255,255,.18);
      border-radius: 999px;
      display:grid;
      place-items:center;
      background: rgba(0,0,0,.18);
      overflow: hidden;
      box-shadow: 0 18px 90px rgba(0,0,0,.60);
    }
    .scrollCue__arrow i{
      animation: arrowDrop 1.45s var(--ease-soft) infinite;
      opacity: .95;
      color: rgba(255,255,255,.92);
    }
    @keyframes arrowDrop{
      0%{ transform: translateY(-2px); opacity: .55; }
      45%{ transform: translateY(6px); opacity: 1; }
      100%{ transform: translateY(-2px); opacity: .55; }
    }

    .split{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap: var(--s-5);
      align-items: start;
    }
    @media (max-width: 980px){
      .split{ grid-template-columns: 1fr; }
    }

    .pillRow{
      margin-top: var(--s-4);
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--s-3);
    }
    @media (max-width: 780px){
      .pillRow{ grid-template-columns: 1fr; }
    }

    .pill{
      border: 0;
      border-radius: 0;
      padding: 0;
      background: transparent;
      box-shadow: none;
    }
    .pill__title{
      margin: 0 0 .35rem;
      font-weight: 950;
      letter-spacing: .14em;
      text-transform: uppercase;
      font-size: .90em;
      color: var(--text);
      display:flex;
      align-items:center;
      gap:.6rem;
    }
    .pill__title i{ color: var(--accent); opacity: .95; }
    .pill__text{ margin: 0; color: var(--muted); max-width: 66ch; }

    .hScroll, .gridItem, .bioPhoto{ border-radius: 0; }

    .hScroll{
      border: 1px solid color-mix(in oklab, var(--border) 85%, transparent);
      background: linear-gradient(180deg, var(--bg-2), var(--bg));
      box-shadow: 0 28px 120px var(--shadow);
      overflow: hidden;
    }
    .hScroll__rail{
      display:flex;
      overflow-x:auto;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }
    .hScroll__rail::-webkit-scrollbar{ display:none; }

    .hScroll__item{
      flex: 0 0 100%;
      scroll-snap-align: start;
      position: relative;
      aspect-ratio: 4 / 5;
      background: linear-gradient(180deg, var(--bg-3), var(--bg));
      border-right: 1px solid color-mix(in oklab, var(--border) 70%, transparent);
      overflow:hidden;
    }
    .hScroll__item:last-child{ border-right: 0; }

    .media{
      position:absolute;
      inset:0;
      overflow:hidden;
      background: linear-gradient(180deg, var(--bg-3), var(--bg));
      display:block;
      text-decoration:none;
      color:inherit;
      cursor: zoom-in;
      -webkit-tap-highlight-color: transparent;
    }

    .media__ph{
      position:absolute;
      inset:0;
      background:
        radial-gradient(140% 120% at 18% 10%, var(--ph-2), transparent 60%),
        radial-gradient(120% 120% at 82% 85%, var(--ph-1), transparent 65%),
        linear-gradient(180deg, var(--bg-3), var(--bg));
      animation: phBreath var(--ph-breath) var(--ease-soft) infinite;
    }
    .media__img{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit: cover;
      object-position: center;
      opacity: 0;
      transform: scale(1.02);
      filter: blur(2px);
      transition: opacity 680ms var(--ease-out), transform 980ms var(--ease-out), filter 980ms var(--ease-out);
      will-change: opacity, transform, filter;
      pointer-events:none;
    }
    .is-loaded .media__img{
      opacity: 1;
      transform: scale(1);
      filter: blur(0);
    }
    .has-error .media__img{ display:none; }

    .hScroll__meta{
      padding: .85rem 1.05rem;
      display:flex;
      justify-content: center;
      align-items:center;
      border-top: 1px solid color-mix(in oklab, var(--border) 70%, transparent);
      background: color-mix(in oklab, var(--surface) 92%, transparent);
    }

    .dots{ display:flex; align-items:center; gap: .45rem; }
    .dot{
      appearance:none;
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: color-mix(in oklab, var(--border) 70%, transparent);
      border: 1px solid color-mix(in oklab, var(--border) 70%, transparent);
      transition: transform var(--dur-2) var(--ease-out), background var(--dur-2) var(--ease-out), border-color var(--dur-2) var(--ease-out);
      cursor: pointer;
      padding: 0;
    }
    .dot.is-active{
      background: var(--accent);
      border-color: color-mix(in oklab, var(--accent) 70%, transparent);
      transform: scale(1.15);
    }
    .dot:focus-visible{ outline: 2px solid color-mix(in oklab, var(--text) 55%, transparent); outline-offset: 4px; }

    .grid3{
      margin-top: var(--s-5);
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: clamp(0.25rem, 0.18rem + 0.30vw, 0.55rem);
    }
    @media (max-width: 980px){
      .grid3{ grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 560px){
      .grid3{ grid-template-columns: 1fr; }
    }
    .gridItem{
      margin: 0;
      border: 1px solid color-mix(in oklab, var(--border) 85%, transparent);
      overflow:hidden;
      background: linear-gradient(180deg, var(--bg-3), var(--bg));
      box-shadow: 0 26px 110px var(--shadow);
      aspect-ratio: 3/4;
      position: relative;
    }

    .stats{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: var(--s-4);
      margin-top: var(--s-5);
    }
    @media (max-width: 980px){
      .stats{ grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 560px){
      .stats{ grid-template-columns: 1fr; }
    }
    .stat{
      border: 0;
      border-radius: 0;
      padding: 0;
      background: transparent;
      box-shadow: none;
      display:flex;
      align-items:center;
      gap: 1rem;
    }
    .stat__icon{
      width: 46px;
      height: 46px;
      border-radius: 16px;
      border: 1px solid color-mix(in oklab, var(--border) 85%, transparent);
      background: color-mix(in oklab, var(--surface) 92%, transparent);
      display:grid;
      place-items:center;
      flex: 0 0 auto;
      box-shadow: 0 18px 80px var(--shadow);
    }
    .stat__icon i{
      color: var(--accent);
      opacity: .95;
      transform: translateY(0);
      transition: transform var(--dur-2) var(--ease-out);
    }
    .stat:hover .stat__icon i{ transform: translateY(-1px); }
    .stat__num{
      font-weight: 950;
      letter-spacing: .06em;
      font-size: 1.15rem;
      margin: 0 0 .10rem;
      color: var(--text);
    }
    .stat__label{
      margin: 0;
      color: var(--muted-2);
      letter-spacing: .12em;
      text-transform: uppercase;
      font-size: .78em;
    }

    .bio{
      display:grid;
      grid-template-columns: .90fr 1.10fr;
      gap: var(--s-5);
      align-items: start;
    }
    @media (max-width: 980px){
      .bio{ grid-template-columns: 1fr; }
    }
    .bioPhoto{
      border: 1px solid color-mix(in oklab, var(--border) 85%, transparent);
      overflow:hidden;
      background: linear-gradient(180deg, var(--bg-3), var(--bg));
      box-shadow: 0 28px 120px var(--shadow);
      aspect-ratio: 3/4;
      position: relative;
    }

    .contactPage{
      padding: clamp(7.5rem, 12vh, 10.5rem) 0 var(--s-6);
    }
    .contactCard{
      margin-top: var(--s-4);
      border: 1px solid color-mix(in oklab, var(--border) 85%, transparent);
      border-radius: var(--r-3);
      padding: var(--s-5);
      background: color-mix(in oklab, var(--surface) 92%, transparent);
      box-shadow: 0 30px 140px var(--shadow);
      display:flex;
      flex-wrap: wrap;
      align-items:flex-start;
      justify-content: space-between;
      gap: var(--s-4);
    }
    .contactCard__right{ display:flex; flex-wrap: wrap; gap: .75rem; align-items:center; }

    .btnEmail{ position: relative; }
    .btnEmail__shell{ display:inline-flex; align-items:center; gap:.55rem; white-space: nowrap; }
    .btnEmail__email{ display:none; letter-spacing: .04em; text-transform: none; font-weight: 900; color: var(--accent); }
    .btnEmail.is-done .btnEmail__labelText{ display:none; }
    .btnEmail.is-done .btnEmail__email{ display:inline; }

    .btnBadge{
      position: absolute;
      left: 50%;
      top: -10px;
      transform: translateX(-50%) translateY(-8px);
      background: color-mix(in oklab, var(--bg) 82%, transparent);
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: .45rem .70rem;
      box-shadow: 0 22px 80px var(--shadow);
      display:flex;
      align-items:center;
      gap:.45rem;
      opacity: 0;
      pointer-events:none;
      transition: opacity var(--dur-2) var(--ease-out), transform var(--dur-2) var(--ease-out);
      z-index: 10;
      color: var(--text);
      letter-spacing: .10em;
      text-transform: uppercase;
      font-weight: 950;
      font-size: .72em;
      white-space: nowrap;
    }
    .btnBadge i{ color: var(--ok); }
    .btnBadge.is-show{
      opacity: 1;
      transform: translateX(-50%) translateY(-16px);
    }

    .site-footer{
      padding: var(--s-4) 0 var(--s-5);
      border-top: 1px solid color-mix(in oklab, var(--border) 80%, transparent);
      background: color-mix(in oklab, var(--bg) 92%, transparent);
    }
    .footer__wrap{
      display:flex;
      justify-content: space-between;
      gap: var(--s-2);
      align-items:center;
      flex-wrap: wrap;
    }
    .footer__links{ display:flex; gap: .9rem; align-items:center; flex-wrap: wrap; }
    .footer__links a{
      color: var(--muted);
      letter-spacing: .12em;
      text-transform: uppercase;
      font-size: .82em;
      display:inline-flex;
      align-items:center;
      gap: .45rem;
      padding: .25rem .35rem;
      border-radius: 10px;
      transition: color var(--dur-2) var(--ease-out), background var(--dur-2) var(--ease-out);
    }
    .footer__links a:hover{
      color: var(--text);
      background: color-mix(in oklab, var(--surface) 92%, transparent);
    }
    .footer__links i{ color: var(--accent); opacity: .95; }

    .reveal{
      opacity: 0;
      transform: translateY(14px);
      filter: blur(2px);
      transition: opacity var(--dur-3) var(--ease-out), transform var(--dur-3) var(--ease-out), filter var(--dur-3) var(--ease-out);
    }
    .reveal.is-inview{
      opacity: 1;
      transform: translateY(0);
      filter: blur(0);
    }

    .icon-btn,
    .chip-btn,
    .btn,
    .btnBadge,
    .headerPill,
    .popMenu,
    .scrollCue__arrow,
    .dot,
    .stat__icon,
    .contactCard,
    .contactCard__right,
    .contactCard__left,
    .footer__links a{
      border-radius: var(--r-ui) !important;
    }

    .heroVideo__mp4{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
      opacity: .92;
      filter: saturate(1.02) contrast(1.02);
      pointer-events:none;
    }

    /* TECH TEASER (home) */
    .techStrip{
      margin-top: var(--s-3);
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--s-2);
    }
    @media (max-width: 900px){
      .techStrip{ grid-template-columns: 1fr; }
    }
    .techCard{
      background: color-mix(in oklab, var(--surface) 70%, transparent);
      border: 1px solid color-mix(in oklab, var(--border) 75%, transparent);
      overflow: hidden;
      position: relative;
      cursor: pointer;
    }
    .techCard__hit{
      position:absolute;
      inset:0;
      z-index:3;
      border-radius: inherit;
    }
    .techCard__media{
      aspect-ratio: 16/10;
      min-height: 320px;
      position: relative;
      overflow: hidden;
    }
    @media (max-width: 900px){
      .techCard__media{ min-height: 240px; }
    }
    .techCard__media img{
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
      transform: scale(1.02);
      transition: transform .6s ease, filter .6s ease, opacity .4s ease;
    }
    .techCard:hover .techCard__media img{
      transform: scale(1.03);
      filter: contrast(1.03);
    }
    .techCard__cap{
      padding: .9rem .9rem .95rem;
      display:flex;
      flex-direction: column;
      gap: .25rem;
    }

    /* EVENTS */
    .eventsBox{
      border: 1px solid color-mix(in oklab, var(--border) 85%, transparent);
      background: color-mix(in oklab, var(--surface) 92%, transparent);
      box-shadow: 0 28px 120px var(--shadow);
      padding: var(--s-4);
    }
    .eventsBox__top{
      display:flex;
      align-items:flex-start;
      justify-content: space-between;
      gap: var(--s-3);
      flex-wrap: wrap;
      padding-bottom: var(--s-2);
      border-bottom: 1px solid color-mix(in oklab, var(--border) 80%, transparent);
      margin-bottom: var(--s-3);
    }
    .mdContent{ color: var(--muted); }
    .mdContent h1, .mdContent h2, .mdContent h3{
      color: var(--text);
      font-family: var(--font-display);
      letter-spacing: .02em;
      margin: 1.15rem 0 .6rem;
    }
    .mdContent h1{ font-size: clamp(1.2rem, 1.0rem + 1.0vw, 1.8rem); }
    .mdContent h2{ font-size: clamp(1.15rem, 1.0rem + 0.9vw, 1.65rem); }
    .mdContent p{ margin: 0 0 .85rem; }
    .mdContent ul{ margin: 0; padding-left: 1.1rem; display:grid; gap: .65rem; }
    .mdContent li{ line-height: 1.6; }
    .mdContent a{
      color: var(--text);
      text-decoration: underline;
      text-underline-offset: 3px;
      text-decoration-thickness: 1px;
      opacity: .92;
    }
    .mdContent a:hover{ opacity: 1; }

    .eventsStatus{
      display:flex;
      align-items:center;
      gap:.55rem;
      letter-spacing: .12em;
      text-transform: uppercase;
      font-weight: 950;
      font-size: .78em;
      color: var(--muted-2);
    }
    .eventsStatus i{ color: var(--accent); opacity: .95; }

  </style>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebSite",
    "name":"Opera viva",
    "url":"https://operaviva.it/"
  }
  </script>
</head>

<body>
  <a class="skip-link" href="#main">Vai al contenuto</a>

  <header class="site-header" data-component="header">
    <div class="wrap header__wrap">
      <div class="headerPill" data-header-pill>
        <button class="icon-btn" type="button" data-action="toggle-menu" aria-label="Menu" aria-expanded="false" title="Menu">
          <i class="fa-solid fa-bars"></i>
        </button>

        <div class="popMenu" data-popmenu aria-hidden="true">
          <a class="icon-btn" href="./" data-route="/" aria-label="Home" title="Home">
            <i class="fa-solid fa-house"></i>
          </a>

          <a class="icon-btn" href="./tecniche" data-route="/tecniche" aria-label="Cosa facciamo" title="Cosa facciamo">
            <i class="fa-solid fa-layer-group"></i>
          </a>

          <a class="icon-btn" href="./contatti" data-route="/contatti" aria-label="Contatti" title="Contatti">
            <i class="fa-solid fa-paper-plane"></i>
          </a>

          <button class="icon-btn" type="button" data-action="toggle-theme" aria-label="Cambia tema (dark/light)" title="Tema">
            <i class="fa-solid fa-sun"></i>
          </button>

          <button class="chip-btn" type="button" data-action="toggle-language" title="Lingua">
            <i class="fa-solid fa-globe"></i>
            <span class="chip-label" data-lang-label>IT</span>
          </button>
        </div>

        <a class="icon-btn headerHomeBtn" href="./" data-route="/" aria-label="Home" title="Home">
          <i class="fa-solid fa-house"></i>
        </a>
      </div>
    </div>
  </header>

  <main id="main">
    <div class="viewShell" data-view-shell aria-live="polite">
      <div data-view="home" data-home-view>

        <!-- HERO -->
        <section class="hero" aria-label="Intro" data-hero>
          <!-- Video trailer background SILENZIOSO, click-to-play come prima -->
          <div class="heroVideo" data-hero-video
               data-video-url="https://www.youtube.com/watch?v=nSSJRcRtqpo"
               data-video-start="8"
               data-video-autoplay="0"
               aria-hidden="true">
            <div class="heroVideo__ph"></div>
            <img class="heroVideo__thumb" alt="" data-thumb>
            <div class="heroVideo__mount" data-video-mount></div>
          </div>

          <div class="wrap hero__wrap">
            <div class="reveal">
              <p class="kicker">Opera viva</p>

              <h1 class="hero__title">
                <span lang="it">Navi e uomini di mare</span>
                <span lang="en">Ships and people of the sea</span>
              </h1>

              <p class="hero__sub">
                <span lang="it">Un progetto fotografico che insegue porti, marinai e imbarcazioni di ogni tipo per raccontarne la storia. Collodio umido, pellicola e infrarosso per fissare monumenti di luce.</span>
                <span lang="en">A photographic project chasing ports, sailors, and vessels of every kind to tell their stories. Wet plate collodion, film, and infrared to fix monuments of light.</span>
              </p>

              <div class="hero__cta">
                <a class="btn btn--primary" href="#progetto" data-route="#progetto">
                  <i class="fa-solid fa-compass"></i>
                  <span lang="it">Scopri</span><span lang="en">Discover</span>
                </a>

                <a class="btn btn--ghost" href="./contatti" data-route="/contatti">
                  <i class="fa-solid fa-paper-plane"></i>
                  <span lang="it">Contatti</span><span lang="en">Contact</span>
                </a>
              </div>

              <div class="scrollCue" aria-hidden="true">
                <div><span lang="it">Scorri</span><span lang="en">Scroll</span></div>
                <div class="scrollCue__arrow"><i class="fa-solid fa-arrow-down"></i></div>
              </div>
            </div>
          </div>
        </section>

        <!-- 2) SPIEGAZIONE -->
        <section id="progetto" class="section" aria-label="Il progetto">
          <div class="wrap split">
            <div class="reveal">
              <p class="kicker">
                <span lang="it">Il progetto</span>
                <span lang="en">The project</span>
              </p>

              <h2 class="h2">
                <span lang="it">Una nuova epopea</span>
                <span lang="en">A new epic</span>
              </h2>

              <p class="lead">
                <span lang="it">
                  Il mare è un luogo dove l’uomo si misura con sé stesso, con la bellezza e con il tempo.
                  Ogni nave che lo attraversa porta un carattere e una memoria, come se fosse un essere vivo.
                </span>
                <span lang="en">
                  The sea is where humans measure themselves against beauty and time.
                  Every ship that crosses it carries character and memory, almost like a living being.
                </span>
              </p>

              <p class="p">
                <span lang="it">
                  Con Opera viva inseguiamo rotte reali e immaginarie: ponti, scafi, volti, ruggine, ferro, sale.
                  Come in un’Odissea contemporanea, ogni approdo è un capitolo, ogni equipaggio un coro, ogni imbarcazione un protagonista.
                </span>
                <span lang="en">
                  With Opera viva we follow real and imaginary routes: decks, hulls, faces, rust, iron, salt.
                  In a contemporary Odyssey, every landing is a chapter, every crew a chorus, every vessel a protagonist.
                </span>
              </p>

              <div class="pillRow" aria-label="Punti chiave">
                <article class="pill reveal">
                  <h3 class="pill__title">
                    <i class="fa-solid fa-water"></i>
                    <span lang="it">Storie di mare</span><span lang="en">Sea stories</span>
                  </h3>
                  <p class="pill__text">
                    <span lang="it">Seguiamo marinai, portuali e navi per raccontare il presente con un’aura antica.</span>
                    <span lang="en">We follow sailors, dockworkers, and ships to tell the present with an ancient aura.</span>
                  </p>
                </article>

                <article class="pill reveal">
                  <h3 class="pill__title">
                    <i class="fa-solid fa-flask"></i>
                    <span lang="it">Tecniche antiche</span><span lang="en">Historic processes</span>
                  </h3>
                  <p class="pill__text">
                    <span lang="it">Collodio umido su metallo e vetro, e pellicola per costruire immagini che hanno materia e tempo.</span>
                    <span lang="en">Wet plate collodion on metal and glass, plus film, to build images with matter and time.</span>
                  </p>
                </article>

                <article class="pill reveal">
                  <h3 class="pill__title">
                    <i class="fa-solid fa-eye"></i>
                    <span lang="it">Infrarosso</span><span lang="en">Infrared</span>
                  </h3>
                  <p class="pill__text">
                    <span lang="it">Uno sguardo che rivela ciò che normalmente resta invisibile, con stampe fine art.</span>
                    <span lang="en">A gaze that reveals what normally stays invisible, finished as fine art prints.</span>
                  </p>
                </article>

                <article class="pill reveal">
                  <h3 class="pill__title">
                    <i class="fa-solid fa-anchor"></i>
                    <span lang="it">Opera finita</span><span lang="en">Finished pieces</span>
                  </h3>
                  <p class="pill__text">
                    <span lang="it">Opere singole, pareti su misura, reportage di viaggio e fotolibro stampato.</span>
                    <span lang="en">Single works, wall-sized commissions, travel reportage, and a printed photo book.</span>
                  </p>
                </article>
              </div>
            </div>

            <!-- GALLERY ORIZZONTALE -->
            <div class="reveal">
              <div class="hScroll" data-hscroll aria-label="Gallery orizzontale Opera viva">
                <div class="hScroll__rail" data-hscroll-rail>
                  <div class="hScroll__item">
                    <a class="media glightbox" href="img/opera-viva-1.jpg" data-gallery="progetto" data-type="image" aria-label="Apri immagine 1">
                      <div class="media__ph" aria-hidden="true"></div>
                      <img class="media__img" data-src="img/opera-viva-1.jpg" alt="Opera viva, foto 01" decoding="async" loading="lazy">
                    </a>
                  </div>
                  <div class="hScroll__item">
                    <a class="media glightbox" href="img/opera-viva-2.jpg" data-gallery="progetto" data-type="image" aria-label="Apri immagine 2">
                      <div class="media__ph" aria-hidden="true"></div>
                      <img class="media__img" data-src="img/opera-viva-2.jpg" alt="Opera viva, foto 02" decoding="async" loading="lazy">
                    </a>
                  </div>
                  <div class="hScroll__item">
                    <a class="media glightbox" href="img/opera-viva-3.jpg" data-gallery="progetto" data-type="image" aria-label="Apri immagine 3">
                      <div class="media__ph" aria-hidden="true"></div>
                      <img class="media__img" data-src="img/opera-viva-3.jpg" alt="Opera viva, foto 03" decoding="async" loading="lazy">
                    </a>
                  </div>
                  <div class="hScroll__item">
                    <a class="media glightbox" href="img/opera-viva-4.jpg" data-gallery="progetto" data-type="image" aria-label="Apri immagine 4">
                      <div class="media__ph" aria-hidden="true"></div>
                      <img class="media__img" data-src="img/opera-viva-4.jpg" alt="Opera viva, foto 04" decoding="async" loading="lazy">
                    </a>
                  </div>
                </div>

                <div class="hScroll__meta">
                  <div class="dots" aria-label="Navigazione gallery" data-hscroll-dots>
                    <button class="dot is-active" type="button" data-dot="0" aria-label="Vai a foto 1"></button>
                    <button class="dot" type="button" data-dot="1" aria-label="Vai a foto 2"></button>
                    <button class="dot" type="button" data-dot="2" aria-label="Vai a foto 3"></button>
                    <button class="dot" type="button" data-dot="3" aria-label="Vai a foto 4"></button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- 3) EVENTI (MD) -->
        <section id="eventi" class="section" aria-label="Eventi">
          <div class="wrap">
            <div class="reveal">
              <p class="kicker">
                <span lang="it">Eventi</span>
                <span lang="en">Events</span>
              </p>

              <h2 class="h2">
                <span lang="it">Mostra itinerante</span>
                <span lang="en">Traveling exhibition</span>
              </h2>

              <p class="lead" style="max-width: 70ch;">
                <span lang="it">Opera viva si muove: tappe, talk e apparizioni cambiano nel tempo. Questa sezione si aggiorna da un semplice file <span class="emph">eventi.md</span>.</span>
                <span lang="en">Opera viva moves: dates, talks, and appearances evolve over time. This section updates from a simple <span class="emph">eventi.md</span> file.</span>
              </p>
            </div>

            <div class="eventsBox reveal" data-events-box>
              <div class="eventsBox__top">
                <div>
                  <p class="micro">
                    <span lang="it">Aggiornamenti rapidi</span>
                    <span lang="en">Quick updates</span>
                  </p>
                  <p class="p" style="margin: .35rem 0 0; max-width: 70ch;">
                    <span lang="it">Emanuele modifica <span class="emph">eventi.md</span>, il sito fa il resto.</span>
                    <span lang="en">Emanuele edits <span class="emph">eventi.md</span>, the site does the rest.</span>
                  </p>
                </div>

                <div class="eventsStatus" data-events-status>
                  <i class="fa-solid fa-circle-notch fa-spin"></i>
                  <span lang="it">Caricamento</span><span lang="en">Loading</span>
                </div>
              </div>

              <div class="mdContent" data-events-md aria-live="polite"></div>
            </div>
          </div>
        </section>

        <!-- 4) COSA FACCIAMO (teaser verso /tecniche) -->
        <section class="section techTeaser" aria-label="Cosa facciamo">
          <div class="wrap">
            <div class="reveal">
              <p class="kicker">
                <span lang="it">Cosa facciamo</span>
                <span lang="en">What we do</span>
              </p>

              <h2 class="h2">
                <span lang="it">Non è estetica. È materia.</span>
                <span lang="en">Not just aesthetics. Material.</span>
              </h2>

              <p class="lead" style="max-width: 70ch;">
                <span lang="it">Opere su misura per pareti, ritratti e imbarcazioni, viaggio a bordo e fotolibro. Le tecniche cambiano davvero l’oggetto finale: metallo, vetro, pellicola, stampa fine art.</span>
                <span lang="en">Wall-sized commissions, portraits and vessels, multi-day onboard work, and a photo book. Techniques truly change the final object: metal, glass, film, fine art print.</span>
              </p>
            </div>

            <div class="reveal" style="margin-top: var(--s-3);">
              <a class="btn btn--primary" href="./tecniche" data-route="/tecniche">
                <i class="fa-solid fa-wand-magic-sparkles"></i>
                <span lang="it">Scopri le differenze</span><span lang="en">Explore the differences</span>
              </a>
            </div>

            <div class="techStrip reveal" aria-label="Anteprima">
              <figure class="techCard">
                <a class="techCard__hit" href="./tecniche" data-route="/tecniche" aria-label="Scopri le differenze"></a>
                <div class="techCard__media"><img src="img/opera-viva-5.jpg" loading="lazy" decoding="async" alt="Infrarosso fine art"></div>
                <figcaption class="techCard__cap">
                  <strong><span lang="it">Infrarosso</span><span lang="en">Infrared</span></strong>
                  <span class="micro"><span lang="it">Rivela l’invisibile</span><span lang="en">Reveal the unseen</span></span>
                </figcaption>
              </figure>

              <figure class="techCard">
                <a class="techCard__hit" href="./tecniche" data-route="/tecniche" aria-label="Scopri le differenze"></a>
                <div class="techCard__media"><img src="img/opera-viva-6.jpg" loading="lazy" decoding="async" alt="Pellicola grande formato"></div>
                <figcaption class="techCard__cap">
                  <strong><span lang="it">Pellicola</span><span lang="en">Film</span></strong>
                  <span class="micro"><span lang="it">Scelta, non raffica</span><span lang="en">A choice, not a burst</span></span>
                </figcaption>
              </figure>

              <figure class="techCard">
                <a class="techCard__hit" href="./tecniche" data-route="/tecniche" aria-label="Scopri le differenze"></a>
                <div class="techCard__media"><img src="img/opera-viva-7.jpg" loading="lazy" decoding="async" alt="Collodio umido su lastra"></div>
                <figcaption class="techCard__cap">
                  <strong><span lang="it">Collodio umido</span><span lang="en">Wet plate</span></strong>
                  <span class="micro"><span lang="it">Metallo e vetro</span><span lang="en">Metal and glass</span></span>
                </figcaption>
              </figure>
            </div>
          </div>
        </section>

        <!-- GALLERY GRID (riuso “Italia” come “Diario di bordo”) -->
        <section id="diario" class="section" aria-label="Diario di bordo">
          <div class="wrap">
            <div class="reveal">
              <h2 class="h2">
                <span lang="it">Diario di bordo</span>
                <span lang="en">Logbook</span>
              </h2>

              <p class="p">
                <span lang="it">Ponti, gru, catene, cabine, volti. Ogni superficie porta segni e stratificazioni. Qui raccogliamo frammenti di rotte, incontri e lavori.</span>
                <span lang="en">Decks, cranes, chains, cabins, faces. Every surface carries marks and layers. Here we collect fragments of routes, encounters, and labor.</span>
              </p>
            </div>

            <div class="grid3" aria-label="Gallery 3x3">
              <figure class="gridItem reveal">
                <a class="media glightbox" href="img/opera-viva-8.jpg" data-gallery="diario" data-type="image" aria-label="Apri foto 1">
                  <div class="media__ph" aria-hidden="true"></div>
                  <img class="media__img" data-src="img/opera-viva-8.jpg" alt="Opera viva, diario 01" decoding="async" loading="lazy">
                </a>
              </figure>

              <figure class="gridItem reveal">
                <a class="media glightbox" href="img/opera-viva-9.jpg" data-gallery="diario" data-type="image" aria-label="Apri foto 2">
                  <div class="media__ph" aria-hidden="true"></div>
                  <img class="media__img" data-src="img/opera-viva-9.jpg" alt="Opera viva, diario 02" decoding="async" loading="lazy">
                </a>
              </figure>

              <figure class="gridItem reveal">
                <a class="media glightbox" href="img/opera-viva-10.jpg" data-gallery="diario" data-type="image" aria-label="Apri foto 3">
                  <div class="media__ph" aria-hidden="true"></div>
                  <img class="media__img" data-src="img/opera-viva-10.jpg" alt="Opera viva, diario 03" decoding="async" loading="lazy">
                </a>
              </figure>
            </div>

            <div class="stats" aria-label="Stato progetto">
              <div class="stat reveal">
                <div class="stat__icon" aria-hidden="true"><i class="fa-solid fa-anchor"></i></div>
                <div>
                  <p class="stat__num"><span lang="it">In corso</span><span lang="en">Ongoing</span></p>
                  <p class="stat__label"><span lang="it">Rotte</span><span lang="en">Routes</span></p>
                </div>
              </div>

              <div class="stat reveal">
                <div class="stat__icon" aria-hidden="true"><i class="fa-solid fa-ship"></i></div>
                <div>
                  <p class="stat__num"><span lang="it">In corso</span><span lang="en">Ongoing</span></p>
                  <p class="stat__label"><span lang="it">Imbarcazioni</span><span lang="en">Vessels</span></p>
                </div>
              </div>

              <div class="stat reveal">
                <div class="stat__icon" aria-hidden="true"><i class="fa-solid fa-warehouse"></i></div>
                <div>
                  <p class="stat__num"><span lang="it">In corso</span><span lang="en">Ongoing</span></p>
                  <p class="stat__label"><span lang="it">Porti</span><span lang="en">Ports</span></p>
                </div>
              </div>

              <div class="stat reveal">
                <div class="stat__icon" aria-hidden="true"><i class="fa-solid fa-book"></i></div>
                <div>
                  <p class="stat__num"><span lang="it">In sviluppo</span><span lang="en">In progress</span></p>
                  <p class="stat__label"><span lang="it">Fotolibro</span><span lang="en">Photo book</span></p>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- CHI SIAMO (riuso BIO) -->
        <section id="bio" class="section" aria-label="Chi siamo">
          <div class="wrap bio">
            <div class="reveal">
              <figure class="bioPhoto" aria-label="Opera viva">
                <div class="media__ph" aria-hidden="true"></div>
                <img class="media__img" data-src="img/opera-viva-4.jpg" alt="Opera viva" decoding="async" loading="lazy">
              </figure>
            </div>

            <div class="reveal">
              <h2 class="h2"><span lang="it">Chi siamo</span><span lang="en">About</span></h2>

              <p class="p">
                <span lang="it">Opera viva è un progetto di Emanuele Passarelli e un collega. Inseguono navi, porti e persone di mare per trasformare il presente in una memoria fisica.</span>
                <span lang="en">Opera viva is a project by Emanuele Passarelli and a colleague. They chase ships, ports, and sea people to turn the present into physical memory.</span>
              </p>

              <p class="p">
                <span lang="it">Il lavoro alterna tecniche antiche e sguardi contemporanei: collodio umido, pellicola, infrarosso, e un’attenzione costante all’oggetto finale, pensato per durare.</span>
                <span lang="en">The work alternates historic processes and contemporary vision: wet plate, film, infrared, and constant focus on the final object, made to last.</span>
              </p>

              <p class="micro">
                <span lang="it">Per richieste, tappe e collaborazioni:</span>
                <span lang="en">For requests, dates, and collaborations:</span>
              </p>

              <div style="margin-top: var(--s-3);">
                <a class="btn btn--primary" href="./contatti" data-route="/contatti">
                  <i class="fa-solid fa-paper-plane"></i>
                  <span lang="it">Vai ai contatti</span><span lang="en">Go to contact</span>
                </a>
              </div>
            </div>
          </div>
        </section>

      </div>
    </div>

    <!-- CONTATTI -->
    <template id="tpl-contact">
      <div data-view="contact" data-contact-view>
        <section class="contactPage" aria-label="Contatti">
          <div class="wrap">
            <div class="reveal">
              <p class="kicker"><span lang="it">Contatti</span><span lang="en">Contact</span></p>
              <h1 class="hero__title" style="max-width: 26ch; margin-bottom: var(--s-2);">
                <span lang="it">Scrivici per tappe e collaborazioni</span>
                <span lang="en">Reach out for dates and collaborations</span>
              </h1>

              <p class="hero__sub" style="margin-bottom: 0; color: var(--muted);">
                <span lang="it">Mostra itinerante, lavori su commissione, reportage e fotolibro. Se vuoi portare Opera viva nella tua città, scrivici.</span>
                <span lang="en">Traveling exhibition, commissions, reportage, and a photo book. If you want Opera viva in your city, write to us.</span>
              </p>

              <p class="micro" style="margin-top: .75rem;">
                <span lang="it">Italia · International</span>
                <span lang="en">Italy · International</span>
              </p>
            </div>

            <div class="contactCard reveal">
              <div style="max-width: 72ch;">
                <p class="lead" style="margin:0;">
                  <span lang="it"><span class="emph">Email</span> e <span class="emph">Instagram</span> sono i canali più veloci. Rispondiamo appena possibile.</span>
                  <span lang="en"><span class="emph">Email</span> and <span class="emph">Instagram</span> are the fastest channels. We reply as soon as we can.</span>
                </p>
              </div>

              <div class="contactCard__right" aria-label="Azioni contatto">
                <button class="btn btn--primary btnEmail" type="button" data-action="copy-email" aria-label="Vedi email e copia">
                  <span class="btnBadge" aria-hidden="true" data-email-badge>
                    <i class="fa-solid fa-circle-check"></i>
                    <span lang="it">Copiata</span><span lang="en">Copied</span>
                  </span>

                  <span class="btnEmail__shell">
                    <i class="fa-solid fa-envelope"></i>
                    <span class="btnEmail__labelText"><span lang="it">Vedi email</span><span lang="en">View email</span></span>
                    <span class="btnEmail__email" data-email-text></span>
                  </span>
                </button>

                <a class="btn btn--ghost" href="#" data-instagram-link rel="noopener" target="_blank">
                  <i class="fa-brands fa-instagram"></i>
                  <span>Instagram</span>
                </a>
              </div>
            </div>
          </div>
        </section>
      </div>
    </template>

    <!-- /TECNICHE (qui diventa “Cosa facciamo”) -->
    <template id="tpl-techniques">
      <div data-view="techniques" data-techniques-view>
        <section class="techStack" aria-label="Cosa facciamo">
          <div class="wrap">
            <div class="techStack__head">
              <p class="kicker techAnim" data-tech-anim>
                <span lang="it">Cosa facciamo</span><span lang="en">What we do</span>
              </p>
              <h1 class="h2 techAnim" data-tech-anim>
                <span lang="it">Tecniche e opere</span><span lang="en">Techniques and works</span>
              </h1>
              <p class="lead techAnim" data-tech-anim style="max-width:72ch;">
                <span lang="it">Non esiste un “look” unico: esiste l’oggetto che vuoi ottenere. Metallo, vetro, pellicola e stampa fine art cambiano presenza, unicità e durata.</span>
                <span lang="en">There is no single look. There is the object you want to obtain. Metal, glass, film, and fine art print change presence, uniqueness, and longevity.</span>
              </p>
            </div>
          </div>

          <div class="techStack__sections">

            <!-- Infrarosso fine art -->
            <section class="techSection" id="infrared">
              <div class="wrap techSection__grid">
                <div class="techSection__media techAnim" data-tech-anim>
                  <div class="techMedia" data-component="smart-media">
                    <div class="media__ph"></div>
                    <img data-src="img/opera-viva-5.jpg" alt="Infrarosso fine art">
                  </div>
                </div>
                <div class="techSection__copy">
                  <h2 class="techSection__title techAnim" data-tech-anim>
                    <span lang="it">Stampe fine art da infrarosso</span><span lang="en">Infrared fine art prints</span>
                  </h2>
                  <p class="techSection__p techAnim" data-tech-anim>
                    <span lang="it">L’infrarosso sposta il confine del visibile e trasforma superfici e atmosfere. È uno sguardo che non “abbellisce”, ma rivela.</span>
                    <span lang="en">Infrared shifts the boundary of the visible and transforms surfaces and atmosphere. It does not beautify, it reveals.</span>
                  </p>
                  <p class="techSection__p techAnim" data-tech-anim>
                    <span lang="it">La stampa è parte del linguaggio: carte e inchiostri pigmentati definiscono profondità, tatto e permanenza.</span>
                    <span lang="en">Printing is part of the language: papers and pigment inks define depth, tactility, and permanence.</span>
                  </p>
                  <p class="techSection__p techAnim" data-tech-anim>
                    <span lang="it">Ideale per opere di grande presenza, serie coerenti e installazioni.</span>
                    <span lang="en">Ideal for large presence works, coherent series, and installations.</span>
                  </p>
                </div>
              </div>
            </section>

            <!-- Pellicola -->
            <section class="techSection" id="film">
              <div class="wrap techSection__grid techSection__grid--flip">
                <div class="techSection__media techAnim" data-tech-anim>
                  <div class="techMedia" data-component="smart-media">
                    <div class="media__ph"></div>
                    <img data-src="img/opera-viva-6.jpg" alt="Pellicola grande formato">
                  </div>
                </div>
                <div class="techSection__copy">
                  <h2 class="techSection__title techAnim" data-tech-anim>
                    <span lang="it">Pellicola</span><span lang="en">Film</span>
                  </h2>
                  <p class="techSection__p techAnim" data-tech-anim>
                    <span lang="it">La pellicola porta una risposta alla luce più “organica” e un ritmo più lento: ogni scatto pesa, ogni decisione resta.</span>
                    <span lang="en">Film brings a more organic response to light and a slower rhythm: every frame matters, every decision remains.</span>
                  </p>
                  <p class="techSection__p techAnim" data-tech-anim>
                    <span lang="it">È perfetta per ritratti e imbarcazioni quando cerchi profondità tonale, grana e un carattere riconoscibile.</span>
                    <span lang="en">Perfect for portraits and vessels when you want tonal depth, grain, and recognizable character.</span>
                  </p>
                  <p class="techSection__p techAnim" data-tech-anim>
                    <span lang="it">L’opera può diventare stampa fine art o parte di un racconto più ampio.</span>
                    <span lang="en">The work can become a fine art print or part of a broader narrative.</span>
                  </p>
                </div>
              </div>
            </section>

            <!-- Tintype -->
            <section class="techSection" id="tintype">
              <div class="wrap techSection__grid">
                <div class="techSection__media techAnim" data-tech-anim>
                  <div class="techMedia" data-component="smart-media">
                    <div class="media__ph"></div>
                    <img data-src="img/opera-viva-7.jpg" alt="Tintype">
                  </div>
                </div>
                <div class="techSection__copy">
                  <h2 class="techSection__title techAnim" data-tech-anim>
                    <span lang="it">Tintype</span><span lang="en">Tintype</span>
                  </h2>
                  <p class="techSection__p techAnim" data-tech-anim>
                    <span lang="it">Collodio umido su metallo: l’immagine nasce come oggetto unico. Graffi, bordi, colature e chimica sono parte della firma.</span>
                    <span lang="en">Wet plate collodion on metal: the image is born as a unique object. Scratches, edges, streaks, and chemistry are part of the signature.</span>
                  </p>
                  <p class="techSection__p techAnim" data-tech-anim>
                    <span lang="it">È una tecnica che trasforma una nave in icona: ferro su ferro, tempo su tempo.</span>
                    <span lang="en">A technique that turns a ship into an icon: iron on iron, time on time.</span>
                  </p>
                  <p class="techSection__p techAnim" data-tech-anim>
                    <span lang="it">Ideale per opere singole e pareti su misura.</span>
                    <span lang="en">Ideal for single works and custom wall pieces.</span>
                  </p>
                </div>
              </div>
            </section>

            <!-- Ambrotype -->
            <section class="techSection" id="ambrotype">
              <div class="wrap techSection__grid techSection__grid--flip">
                <div class="techSection__media techAnim" data-tech-anim>
                  <div class="techMedia" data-component="smart-media">
                    <div class="media__ph"></div>
                    <img data-src="img/opera-viva-8.jpg" alt="Ambrotype">
                  </div>
                </div>
                <div class="techSection__copy">
                  <h2 class="techSection__title techAnim" data-tech-anim>
                    <span lang="it">Ambrotipo</span><span lang="en">Ambrotype</span>
                  </h2>
                  <p class="techSection__p techAnim" data-tech-anim>
                    <span lang="it">Collodio umido su vetro: più trasparenza, più profondità, e una delicatezza che contrasta con la durezza del mare.</span>
                    <span lang="en">Wet plate on glass: more transparency, more depth, and a delicacy that contrasts the harshness of the sea.</span>
                  </p>
                  <p class="techSection__p techAnim" data-tech-anim>
                    <span lang="it">È un pezzo unico, fragile e potente, come una reliquia. Perfetto per ritratti e dettagli di bordo.</span>
                    <span lang="en">A unique piece, fragile and powerful, like a relic. Perfect for portraits and onboard details.</span>
                  </p>
                  <p class="techSection__p techAnim" data-tech-anim>
                    <span lang="it">Può diventare opera da collezione o parte di installazioni.</span>
                    <span lang="en">It can become a collectible work or part of installations.</span>
                  </p>
                </div>
              </div>
            </section>

            <!-- Viaggio + Fotolibro -->
            <section class="techSection" id="voyage">
              <div class="wrap techSection__grid">
                <div class="techSection__media techAnim" data-tech-anim>
                  <div class="techMedia" data-component="smart-media">
                    <div class="media__ph"></div>
                    <img data-src="img/opera-viva-9.jpg" alt="Reportage e fotolibro">
                  </div>
                </div>
                <div class="techSection__copy">
                  <h2 class="techSection__title techAnim" data-tech-anim>
                    <span lang="it">Imbarco, racconto, fotolibro</span><span lang="en">Onboard, story, photo book</span>
                  </h2>
                  <p class="techSection__p techAnim" data-tech-anim>
                    <span lang="it">Possiamo imbarcarci per più giorni per raccontare un lavoro, una rotta, una comunità. La fotografia diventa diario.</span>
                    <span lang="en">We can embark for multiple days to tell a job, a route, a community. Photography becomes a logbook.</span>
                  </p>
                  <p class="techSection__p techAnim" data-tech-anim>
                    <span lang="it">Il risultato può essere una serie di opere, una mostra, e un fotolibro stampato che raccoglie storia e immagini in un oggetto finale.</span>
                    <span lang="en">The result can be a series of works, an exhibition, and a printed photo book that gathers story and images into a final object.</span>
                  </p>
                  <p class="techSection__p techAnim" data-tech-anim>
                    <span lang="it">È la forma più completa: tempo, presenza, memoria.</span>
                    <span lang="en">It is the most complete form: time, presence, memory.</span>
                  </p>
                </div>
              </div>
            </section>

          </div>
        </section>
      </div>
    </template>

  </main>

  <footer class="site-footer" data-component="footer">
    <div class="wrap footer__wrap">
      <p class="micro">© <span data-year></span> Opera viva</p>
      <div class="footer__links">
        <a href="#main" data-action="back-to-top"><i class="fa-solid fa-arrow-up"></i><span lang="it">Top</span><span lang="en">Top</span></a>
        <a href="./tecniche" data-route="/tecniche"><i class="fa-solid fa-layer-group"></i><span lang="it">Cosa facciamo</span><span lang="en">What we do</span></a>
        <a href="./contatti" data-route="/contatti"><i class="fa-solid fa-paper-plane"></i><span lang="it">Contatti</span><span lang="en">Contact</span></a>
      </div>
    </div>
  </footer>

  <div class="sr-only" aria-live="polite" aria-atomic="true" data-announcer></div>

  <!-- Lightbox JS (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js"></script>

  <!-- Markdown parser + sanitizer (CDN affidabili) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/12.0.2/marked.min.js" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.11/purify.min.js" referrerpolicy="no-referrer"></script>

  <script>
    (function(){
      "use strict";

      const root = document.documentElement;
      const header = document.querySelector('[data-component="header"]');
      const announcer = document.querySelector('[data-announcer]');
      const viewShell = document.querySelector('[data-view-shell]');
      const tplContact = document.getElementById('tpl-contact');
      const tplTechniques = document.getElementById('tpl-techniques');

      const popMenu = document.querySelector('[data-popmenu]');
      const menuToggle = document.querySelector('[data-action="toggle-menu"]');

      /* =========================
         CONFIG (cambia qui)
      ========================= */
      const SITE_TITLE_IT = "Opera viva";
      const SITE_TITLE_EN = "Opera viva";

      // TODO: se pubblichi su GitHub Pages come project site, cambia repo
      const GITHUB_REPO = "opera-viva";

      // TODO: cambia contatto e Instagram quando definitivi
      const CONTACT_EMAIL = "emanuelepassarelli1@gmail.com";
      const INSTAGRAM_URL = "https://instagram.com/emanuelepassarelli";

      // TODO: se vuoi forzare canonical e OG in runtime (opzionale)
      const SITE_CANONICAL = "https://operaviva.it/";
      const OG_IMAGE = "https://operaviva.it/img/og-cover.jpg";

      const emailValue = CONTACT_EMAIL;
      let HOME_HTML = "";
      let heroIO = null;
      let cleanupView = null;

      const initTechniquesDeck = (scope) => {
        const rootEl = scope || document;
        const items = Array.from(rootEl.querySelectorAll('[data-tech-anim]'));
        if(items.length === 0) return () => {};

        const io = new IntersectionObserver((entries) => {
          entries.forEach((e) => {
            if(e.isIntersecting){
              e.target.classList.add('is-in');
              io.unobserve(e.target);
            }
          });
        }, { threshold: 0.15, rootMargin: '0px 0px -8% 0px' });

        items.forEach((el) => io.observe(el));

        return () => {
          try{ io.disconnect(); }catch{}
        };
      };

      let lightbox = null;

      const isGithubHost = window.location.hostname.toLowerCase().endsWith(".github.io");
      const BASE_PATH = isGithubHost ? ("/" + GITHUB_REPO) : "";

      const resolveAssetUrl = (u) => {
        const s = (u || '').trim();
        if(!s) return s;
        if(/^([a-z]+:)?\/\//i.test(s) || s.startsWith('data:') || s.startsWith('blob:')) return s;
        const clean = s.replace(/^\.\//, '');

        if(clean === 'eventi.md'){
          return (BASE_PATH || '') + '/' + clean;
        }

        if(clean.startsWith('img/') || clean.startsWith('videos/') || clean.startsWith('assets/') || clean.startsWith('fonts/')){
          return (BASE_PATH || '') + '/' + clean;
        }
        return s;
      };

      const fixRelativeImgs = (scope) => {
        const rootEl = scope || document;
        rootEl.querySelectorAll('img[src]').forEach((img) => {
          const src = img.getAttribute('src');
          const fixed = resolveAssetUrl(src);
          if(fixed && fixed !== src) img.setAttribute('src', fixed);
        });
      };

      const prefersReducedMotion = () =>
        window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      const safeStorage = {
        get(key){ try{ return localStorage.getItem(key); }catch{ return null; } },
        set(key,val){ try{ localStorage.setItem(key,val); }catch{ } }
      };

      const announce = (msg) => { if(announcer) announcer.textContent = msg; };

      const normalizeRoute = (p) => {
        let s = (p || '/');
        s = s.replace(/\/+$/, '');
        if(s === '') s = '/';
        if(!s.startsWith('/')) s = '/' + s;
        return s;
      };

      const routeFromLocation = () => {
        let p = window.location.pathname || '/';
        if(BASE_PATH && p.startsWith(BASE_PATH)){
          p = p.slice(BASE_PATH.length) || '/';
        }
        return normalizeRoute(p);
      };

      const withBase = (route) => {
        const r = normalizeRoute(route);
        if(!BASE_PATH) return r;
        if(r === '/') return BASE_PATH + '/';
        return BASE_PATH + r;
      };

      const isMenuOpen = () => popMenu && popMenu.classList.contains('is-open');

      const openMenu = () => {
        if(!popMenu || !menuToggle) return;
        popMenu.classList.add('is-open');
        popMenu.setAttribute('aria-hidden', 'false');
        menuToggle.classList.add('is-active');
        menuToggle.setAttribute('aria-expanded', 'true');
      };

      const closeMenu = () => {
        if(!popMenu || !menuToggle) return;
        popMenu.classList.remove('is-open');
        popMenu.setAttribute('aria-hidden', 'true');
        menuToggle.classList.remove('is-active');
        menuToggle.setAttribute('aria-expanded', 'false');
      };

      const toggleMenu = () => { isMenuOpen() ? closeMenu() : openMenu(); };

      const THEME_KEY = 'ov_theme';
      const applyTheme = (theme) => {
        const t = theme === 'light' ? 'light' : 'dark';
        root.setAttribute('data-theme', t);
        safeStorage.set(THEME_KEY, t);
        document.querySelectorAll('[data-action="toggle-theme"] i').forEach((icon) => {
          icon.className = (t === 'dark') ? 'fa-solid fa-sun' : 'fa-solid fa-moon';
        });
      };
      const initTheme = () => {
        const saved = safeStorage.get(THEME_KEY);
        if(saved){ applyTheme(saved); return; }
        applyTheme('dark');
      };

      const LANG_KEY = 'ov_lang';

      const updateLangToggleUI = () => {
        const l = (root.getAttribute('data-language') === 'en') ? 'en' : 'it';
        const next = (l === 'it') ? 'en' : 'it';

        document.querySelectorAll('[data-lang-label]').forEach(el => {
          el.textContent = l.toUpperCase();
        });

        document.querySelectorAll('[data-action="toggle-language"]').forEach(btn => {
          const aria = (next === 'en') ? 'Cambia lingua in inglese' : 'Switch language to Italian';
          btn.setAttribute('aria-label', aria);
          btn.setAttribute('title', (next === 'en') ? 'EN' : 'IT');
        });
      };

      const applyLanguage = (lang) => {
        const l = lang === 'en' ? 'en' : 'it';
        root.setAttribute('data-language', l);
        safeStorage.set(LANG_KEY, l);
        document.documentElement.setAttribute('lang', l);
        updateLangToggleUI();
        announce(l === 'it' ? 'Lingua impostata su Italiano' : 'Language set to English');
      };

      const initLanguage = () => {
        const params = new URLSearchParams(window.location.search);
        const urlLang = params.get('lang');
        const saved = safeStorage.get(LANG_KEY);
        applyLanguage(urlLang || saved || 'it');
      };

      const initHeaderScroll = () => {
        if(!header) return;
        let ticking = false;

        const onScroll = () => {
          header.classList.toggle('is-scrolled', window.scrollY > 12);
          ticking = false;
        };

        window.addEventListener('scroll', () => {
          if (ticking) return;
          ticking = true;
          requestAnimationFrame(onScroll);
        }, { passive: true });

        onScroll();
      };

      const initHeaderHeroSense = () => {
        if(!header) return;

        header.classList.remove('is-over-hero');
        if(heroIO){ try{ heroIO.disconnect(); }catch{} heroIO = null; }

        const hero = document.querySelector('[data-hero]');
        if(!hero) return;

        if('IntersectionObserver' in window){
          heroIO = new IntersectionObserver((entries) => {
            const entry = entries[0];
            if(!entry) return;
            header.classList.toggle('is-over-hero', !!entry.isIntersecting);
          }, { threshold: 0.15 });

          heroIO.observe(hero);
        } else {
          header.classList.add('is-over-hero');
        }
      };

      const revealIn = (scope) => {
        const rootEl = scope || document;
        const els = Array.from(rootEl.querySelectorAll('.reveal'));
        if(!els.length) return;

        if(prefersReducedMotion()){
          els.forEach(el => el.classList.add('is-inview'));
          return;
        }

        if('IntersectionObserver' in window){
          const io = new IntersectionObserver((entries) => {
            entries.forEach((entry) => {
              if(!entry.isIntersecting) return;
              entry.target.classList.add('is-inview');
              io.unobserve(entry.target);
            });
          }, { rootMargin: '0px 0px -10% 0px', threshold: 0.12 });

          els.forEach(el => io.observe(el));
        } else {
          els.forEach(el => el.classList.add('is-inview'));
        }
      };

      const smartMediaIn = (scope) => {
        const rootEl = scope || document;
        const imgs = Array.from(rootEl.querySelectorAll('img[data-src]'));
        if(!imgs.length) return;

        const loadImg = (img) => {
          const src = img.getAttribute('data-src');
          if(!src) return;

          const holder = img.closest('[data-component="smart-media"]') || img.parentElement;
          const onLoad = () => holder && holder.classList.add('is-loaded');
          const onError = () => holder && holder.classList.add('has-error');

          img.addEventListener('load', onLoad, { once: true });
          img.addEventListener('error', onError, { once: true });

          img.setAttribute('src', resolveAssetUrl(src));
          img.removeAttribute('data-src');
        };

        if('IntersectionObserver' in window){
          const io = new IntersectionObserver((entries) => {
            entries.forEach((entry) => {
              if(!entry.isIntersecting) return;
              io.unobserve(entry.target);
              loadImg(entry.target);
            });
          }, { rootMargin: '0px', threshold: 0.01 });

          imgs.forEach(img => io.observe(img));
        } else {
          imgs.forEach(loadImg);
        }
      };

      const initLightbox = () => {
        if(!window.GLightbox) return;
        if(lightbox){
          try{ lightbox.destroy(); }catch{}
          lightbox = null;
        }
        lightbox = window.GLightbox({
          selector: '.glightbox',
          touchNavigation: true,
          keyboardNavigation: true,
          closeButton: true,
          loop: true,
          zoomable: false,
          draggable: true,
          openEffect: 'fade',
          closeEffect: 'fade',
          slideEffect: 'slide',
          skin: 'clean'
        });
      };

      const initHeroVideo = () => {
        const heroVideo = document.querySelector('[data-hero-video]');
        if(!heroVideo) return;

        const videoUrl = (heroVideo.getAttribute('data-video-url') || '').trim();
        const startAt = Number(heroVideo.getAttribute('data-video-start') || '0') || 0;
        const autoplay = String(heroVideo.getAttribute('data-video-autoplay') || '0') === '1';

        const img = heroVideo.querySelector('[data-thumb]');
        const mount = heroVideo.querySelector('[data-video-mount]');
        if(!videoUrl || !img || !mount) return;

        const reduce = prefersReducedMotion();
        const isYouTube = /youtube\.com|youtu\.be/i.test(videoUrl);

        const getYouTubeId = (url) => {
          try{
            const u = new URL(url);
            if(u.hostname.includes('youtu.be')) return u.pathname.replace('/', '') || '';
            if(u.searchParams.get('v')) return u.searchParams.get('v') || '';
            const m = u.pathname.match(/\/embed\/([^/]+)/);
            return m ? (m[1] || '') : '';
          }catch{
            const m = String(url).match(/(?:v=|youtu\.be\/|\/embed\/)([A-Za-z0-9_-]{6,})/);
            return m ? m[1] : '';
          }
        };

        const mountYouTube = (videoId) => {
          if(heroVideo.classList.contains('is-mounted')) return;

          const cover = document.createElement('div');
          cover.className = 'heroVideo__cover';

          const iframe = document.createElement('iframe');
          iframe.title = "Hero video";
          iframe.loading = "eager";
          iframe.allowFullscreen = false;
          iframe.referrerPolicy = "strict-origin-when-cross-origin";
          iframe.allow = "autoplay; encrypted-media; picture-in-picture; web-share";

          const params = new URLSearchParams({
            autoplay: (autoplay && !reduce) ? "1" : "0",
            mute: "1",
            playsinline: "1",
            rel: "0",
            modestbranding: "1",
            controls: "0",
            disablekb: "1",
            fs: "0",
            iv_load_policy: "3",
            start: String(Math.max(0, startAt)),
            loop: "1",
            playlist: videoId
          });

          iframe.src = "https://www.youtube-nocookie.com/embed/" + encodeURIComponent(videoId) + "?" + params.toString();

          cover.appendChild(iframe);
          mount.appendChild(cover);
          heroVideo.classList.add('is-mounted');
        };

        const mountMP4 = (srcUrl) => {
          if(heroVideo.classList.contains('is-mounted')) return;

          const v = document.createElement('video');
          v.className = 'heroVideo__mp4';
          v.autoplay = autoplay && !reduce;
          v.muted = true;
          v.loop = true;
          v.playsInline = true;
          v.preload = 'metadata';

          const s = document.createElement('source');
          s.src = srcUrl;
          s.type = 'video/mp4';
          v.appendChild(s);

          v.addEventListener('loadedmetadata', () => {
            if(startAt > 0 && Number.isFinite(startAt)){
              try{ v.currentTime = Math.max(0, startAt); }catch{}
            }
            if(autoplay && !reduce){
              v.play().catch(() => {});
            }
          }, { once: true });

          mount.appendChild(v);
          heroVideo.classList.add('is-mounted');
        };

        const enableClickToPlay = (fn) => {
          const onClick = () => {
            fn();
            heroVideo.removeEventListener('click', onClick);
            heroVideo.classList.remove('is-clickable');
          };
          heroVideo.classList.add('is-clickable');
          heroVideo.addEventListener('click', onClick, { once: true });
        };

        if(isYouTube){
          const id = getYouTubeId(videoUrl);
          if(!id) return;

          const candidates = [
            `https://i.ytimg.com/vi/${encodeURIComponent(id)}/maxresdefault.jpg`,
            `https://i.ytimg.com/vi/${encodeURIComponent(id)}/hqdefault.jpg`
          ];

          let idx = 0;
          const tryLoad = () => {
            img.onload = () => heroVideo.classList.add('is-thumb-loaded');
            img.onerror = () => { idx += 1; if(idx < candidates.length) tryLoad(); };
            img.src = candidates[idx];
          };
          tryLoad();

          if(autoplay && !reduce){
            const delayed = () => window.setTimeout(() => mountYouTube(id), 260);
            if('requestIdleCallback' in window){
              window.requestIdleCallback(delayed, { timeout: 1200 });
            } else {
              delayed();
            }
          } else {
            enableClickToPlay(() => mountYouTube(id));
          }
        } else {
          heroVideo.classList.add('is-thumb-loaded');

          if(autoplay && !reduce){
            const delayed = () => window.setTimeout(() => mountMP4(videoUrl), 120);
            if('requestIdleCallback' in window){
              window.requestIdleCallback(delayed, { timeout: 1200 });
            } else {
              delayed();
            }
          } else {
            enableClickToPlay(() => mountMP4(videoUrl));
          }
        }
      };

      const initHScroll = () => {
        const box = document.querySelector('[data-hscroll]');
        if(!box) return;
        const rail = box.querySelector('[data-hscroll-rail]');
        const dotsWrap = box.querySelector('[data-hscroll-dots]');
        if(!rail || !dotsWrap) return;

        const dots = Array.from(dotsWrap.querySelectorAll('.dot'));
        const max = dots.length;

        const setActive = (idx) => {
          dots.forEach((d, i) => d.classList.toggle('is-active', i === idx));
        };

        const snapWidth = () => rail.getBoundingClientRect().width || 1;

        const goTo = (idx) => {
          const w = snapWidth();
          const target = Math.max(0, Math.min(max - 1, idx));
          rail.scrollTo({
            left: target * w,
            behavior: prefersReducedMotion() ? 'auto' : 'smooth'
          });
          setActive(target);
        };

        const onScroll = () => {
          const w = snapWidth();
          const idx = Math.round(rail.scrollLeft / w);
          setActive(Math.max(0, Math.min(max - 1, idx)));
        };

        rail.addEventListener('scroll', () => requestAnimationFrame(onScroll), { passive: true });

        dotsWrap.addEventListener('click', (e) => {
          const btn = e.target.closest('.dot[data-dot]');
          if(!btn) return;
          const idx = Number(btn.getAttribute('data-dot'));
          if(Number.isFinite(idx)) goTo(idx);
        });

        setActive(0);
      };

      const copyToClipboard = async (text) => {
        try{
          if(navigator.clipboard && navigator.clipboard.writeText){
            await navigator.clipboard.writeText(text);
            return true;
          }
        }catch{}

        try{
          const ta = document.createElement('textarea');
          ta.value = text;
          ta.setAttribute('readonly', '');
          ta.style.position = 'fixed';
          ta.style.top = '-9999px';
          document.body.appendChild(ta);
          ta.select();
          document.execCommand('copy');
          ta.remove();
          return true;
        }catch{
          return false;
        }
      };

      const showEmailBadge = (btn) => {
        const badge = btn.querySelector('[data-email-badge]');
        if(!badge) return;
        badge.classList.add('is-show');
        window.clearTimeout(badge._t);
        badge._t = window.setTimeout(() => badge.classList.remove('is-show'), 1100);
      };

      const setDocForRoute = (route) => {
        if(route === '/contatti'){
          document.title = (root.getAttribute('data-language') === 'en')
            ? ("Contact | " + SITE_TITLE_EN)
            : ("Contatti | " + SITE_TITLE_IT);
          return;
        }

        if(route === '/tecniche'){
          document.title = (root.getAttribute('data-language') === 'en')
            ? ("What we do | " + SITE_TITLE_EN)
            : ("Cosa facciamo | " + SITE_TITLE_IT);
          return;
        }

        document.title = SITE_TITLE_IT + " | Navi, equipaggi, tecniche antiche";
      };

      const setRouteUI = (route) => {
        const r = normalizeRoute(route || '/');
        document.body.classList.toggle('is-home-route', r === '/' );
      };

      /* EVENTS: fetch eventi.md, parse Markdown, sanitize, inject */
      const initEvents = async (scope) => {
        const rootEl = scope || document;
        const box = rootEl.querySelector('[data-events-box]');
        const out = rootEl.querySelector('[data-events-md]');
        const status = rootEl.querySelector('[data-events-status]');
        if(!box || !out || !status) return;

        const setStatus = (state) => {
          const lang = (root.getAttribute('data-language') === 'en') ? 'en' : 'it';
          if(state === 'loading'){
            status.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i>' + (lang === 'it' ? '<span>Caricamento</span>' : '<span>Loading</span>');
          } else if(state === 'ok'){
            status.innerHTML = '<i class="fa-solid fa-circle-check"></i>' + (lang === 'it' ? '<span>Aggiornato</span>' : '<span>Updated</span>');
          } else {
            status.innerHTML = '<i class="fa-solid fa-triangle-exclamation"></i>' + (lang === 'it' ? '<span>Non disponibile</span>' : '<span>Unavailable</span>');
          }
        };

        setStatus('loading');

        const mdUrl = resolveAssetUrl('eventi.md');
        const bust = mdUrl.includes('?') ? '&v=' : '?v=';
        const url = mdUrl + bust + String(Date.now());

        try{
          const res = await fetch(url, { cache: 'no-store' });
          if(!res.ok) throw new Error('HTTP ' + res.status);

          const md = await res.text();

          if(!window.marked){
            throw new Error('marked missing');
          }

          const rawHtml = window.marked.parse(md, {
            breaks: true,
            mangle: false,
            headerIds: false
          });

          const safeHtml = window.DOMPurify ? window.DOMPurify.sanitize(rawHtml) : rawHtml;
          out.innerHTML = safeHtml;

          setStatus('ok');
        }catch{
          out.innerHTML = (root.getAttribute('data-language') === 'en')
            ? '<p>No events file found yet. Create <strong>eventi.md</strong> next to <strong>index.html</strong>.</p>'
            : '<p>Nessun file eventi trovato. Crea <strong>eventi.md</strong> accanto a <strong>index.html</strong>.</p>';
          setStatus('err');
        }
      };

      const swapView = async (route, opts) => {
        if(!viewShell) return;

        const routeNorm = normalizeRoute(route || '/');
        const current = viewShell.querySelector('[data-view]')?.getAttribute('data-view') || 'home';
        const target = (routeNorm === '/contatti')
          ? 'contact'
          : (routeNorm === '/tecniche' ? 'techniques' : 'home');
        if(current === target) return;

        const reduce = prefersReducedMotion();
        const doAnim = !reduce;

        viewShell.classList.add('is-swapping');
        if(doAnim){
          viewShell.classList.add('is-leaving');
          await new Promise(r => window.setTimeout(r, 220));
        }

        if(cleanupView){
          try{ cleanupView(); }catch{}
          cleanupView = null;
        }

        viewShell.innerHTML = '';

        if(target === 'contact'){
          const frag = tplContact.content.cloneNode(true);
          viewShell.appendChild(frag);

          // Fill contact UI
          const emailEl = viewShell.querySelector('[data-email-text]');
          if(emailEl) emailEl.textContent = CONTACT_EMAIL;

          const ig = viewShell.querySelector('[data-instagram-link]');
          if(ig) ig.setAttribute('href', INSTAGRAM_URL);

        } else if(target === 'techniques'){
          const frag = tplTechniques.content.cloneNode(true);
          viewShell.appendChild(frag);
        } else {
          viewShell.innerHTML = HOME_HTML;
        }

        setDocForRoute(routeNorm);
        setRouteUI(routeNorm);

        viewShell.classList.remove('is-leaving');
        if(doAnim){
          viewShell.classList.add('is-entering');
          void viewShell.offsetHeight;
          viewShell.classList.remove('is-entering');
          viewShell.classList.add('is-entered');
          window.setTimeout(() => viewShell.classList.remove('is-entered'), 740);
        }

        revealIn(viewShell);
        smartMediaIn(viewShell);
        fixRelativeImgs(viewShell);

        if(target === 'techniques'){
          cleanupView = initTechniquesDeck(viewShell);
        }

        if(target === 'home'){
          initHScroll();
          initHeroVideo();
          initEvents(viewShell);
        }

        initLightbox();
        initHeaderHeroSense();

        if(opts && opts.scrollTo){
          const id = opts.scrollTo;
          const el = document.querySelector(id);
          if(el) el.scrollIntoView({ behavior: prefersReducedMotion() ? 'auto' : 'smooth', block: 'start' });
        } else {
          window.scrollTo({ top: 0, behavior: prefersReducedMotion() ? 'auto' : 'smooth' });
        }

        viewShell.classList.remove('is-swapping');
      };

      const navigate = async (to, options) => {
        const target = to || '/';
        const isHash = target.startsWith('#');

        if(isHash){
          const r = routeFromLocation();
          if(r === '/'){
            const el = document.querySelector(target);
            if(el) el.scrollIntoView({ behavior: prefersReducedMotion() ? 'auto' : 'smooth', block: 'start' });
            return;
          }
          history.pushState({ route: '/' }, "", withBase('/'));
          await swapView('/', { scrollTo: target });
          return;
        }

        const route = (target === '/contatti')
          ? '/contatti'
          : (target === '/tecniche' ? '/tecniche' : '/');
        history.pushState({ route }, "", withBase(route));
        await swapView(route, options);
      };

      const initActions = () => {
        document.addEventListener('click', async (e) => {
          const routeLink = e.target.closest('[data-route]');
          if(routeLink){
            const to = routeLink.getAttribute('data-route');
            const href = routeLink.getAttribute('href') || to || '';
            const dest = to || href;

            if(dest && (dest.startsWith('/') || dest.startsWith('#'))){
              e.preventDefault();
              closeMenu();
              await navigate(dest);
              return;
            }
          }

          const btn = e.target.closest('[data-action]');
          if(!btn) return;
          const action = btn.getAttribute('data-action');

          if(action === 'toggle-menu'){
            e.preventDefault();
            toggleMenu();
            return;
          }

          if(action === 'toggle-theme'){
            const current = root.getAttribute('data-theme') || 'dark';
            const next = current === 'dark' ? 'light' : 'dark';
            applyTheme(next);
            announce(next === 'dark' ? 'Tema scuro attivo' : 'Tema chiaro attivo');
            return;
          }

          if(action === 'toggle-language'){
            const current = (root.getAttribute('data-language') === 'en') ? 'en' : 'it';
            const next = (current === 'it') ? 'en' : 'it';
            applyLanguage(next);
            setDocForRoute(routeFromLocation());
            initEvents(document); // refresh labels
            return;
          }

          if(action === 'back-to-top'){
            e.preventDefault();
            window.scrollTo({ top: 0, behavior: prefersReducedMotion() ? 'auto' : 'smooth' });
            return;
          }

          if(action === 'copy-email'){
            const ok = await copyToClipboard(emailValue);
            btn.classList.add('is-done');
            announce(ok ? 'Email copiata' : 'Copia non riuscita');
            if(ok) showEmailBadge(btn);
            window.clearTimeout(btn._t);
            btn._t = window.setTimeout(() => btn.classList.remove('is-done'), 2200);
            return;
          }
        });

        document.addEventListener('keydown', (e) => {
          if(e.key === 'Escape') closeMenu();
        });

        document.addEventListener('pointerdown', (e) => {
          if(!isMenuOpen()) return;
          const inside = e.target.closest('[data-popmenu]') || e.target.closest('[data-action="toggle-menu"]');
          if(!inside) closeMenu();
        }, { passive: true });

        window.addEventListener('popstate', async () => {
          closeMenu();
          await swapView(routeFromLocation());
        });
      };

      const initYear = () => {
        const el = document.querySelector('[data-year]');
        if(el) el.textContent = String(new Date().getFullYear());
      };

      const initHomeSnapshot = () => {
        if(!viewShell) return;
        const home = viewShell.querySelector('[data-home-view]');
        if(home) HOME_HTML = home.outerHTML;
      };

      const initFirstRoute = async () => {
        const r = routeFromLocation();
        setDocForRoute(r);
        setRouteUI(r);

        if(r === '/contatti'){
          await swapView('/contatti', {});
          return;
        }

        if(r === '/tecniche'){
          await swapView('/tecniche', {});
          return;
        }

        initHeaderHeroSense();
      };

      const init = async () => {
        initTheme();
        initLanguage();

        initHomeSnapshot();
        initActions();
        initHeaderScroll();
        initYear();

        revealIn(document);
        smartMediaIn(document);
        fixRelativeImgs(document);

        initHScroll();
        initHeroVideo();
        initLightbox();
        initHeaderHeroSense();
        initEvents(document);

        await initFirstRoute();
      };

      if(document.readyState === 'loading'){
        document.addEventListener('DOMContentLoaded', init, { once: true });
      } else {
        init();
      }
    })();
  </script>

  <script>
    (function(){
      const prevent = (e) => { e.preventDefault(); };
      document.addEventListener('gesturestart', prevent, { passive: false });
      document.addEventListener('gesturechange', prevent, { passive: false });
      document.addEventListener('gestureend', prevent, { passive: false });

      let lastTouchEnd = 0;
      document.addEventListener('touchend', (e) => {
        const now = Date.now();
        if(now - lastTouchEnd <= 300){
          e.preventDefault();
        }
        lastTouchEnd = now;
      }, { passive: false });
    })();
  </script>
</body>
</html>
